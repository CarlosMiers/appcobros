<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="dismiss()" class="back-button">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="header-title">
      <div class="title-container">
        <ion-icon name="print" class="title-icon"></ion-icon>
        Configurar Impresora
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="content-background">
  <ion-card class="main-card fade-in-up">
    <ion-card-header class="card-header-icon">
      <ion-icon name="bluetooth-outline"></ion-icon>
      <ion-card-title>Búsqueda de Impresoras</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-button expand="block" color="tertiary" (click)="listarDispositivos()" class="action-button-search">
        <ion-icon name="search-outline"></ion-icon>
        Buscar dispositivos Bluetooth
      </ion-button>
      
      <ion-list class="device-list" lines="none">
        <ion-item class="device-item" *ngFor="let dispositivo of dispositivos" (click)="conectar(dispositivo)">
          <ion-icon name="bluetooth" slot="start" class="list-icon"></ion-icon>
          <ion-label>
            <p class="device-name">{{ dispositivo.name || 'Sin nombre' }}</p>
            <small class="device-address">{{ dispositivo.address }}</small>
          </ion-label>
          <ion-icon name="checkmark-circle" slot="end" color="success" *ngIf="dispositivo.address === dispositivoSeleccionado?.address"></ion-icon>
        </ion-item>
      </ion-list>

      <div class="empty-state-list" *ngIf="dispositivos.length === 0">
        <ion-icon name="bluetooth-outline"></ion-icon>
        <p>No se encontraron dispositivos cercanos.</p>
      </div>

    </ion-card-content>
  </ion-card>

  <ion-card class="main-card fade-in-up">
    <ion-card-header class="card-header-icon">
      <ion-icon name="analytics-outline"></ion-icon>
      <ion-card-title>Estado de la Impresora</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="status-info" *ngIf="dispositivoSeleccionado">
        <p><strong>Dispositivo Conectado:</strong> {{ dispositivoSeleccionado.name }}</p>
        <p><strong>Dirección:</strong> {{ dispositivoSeleccionado.address }}</p>
      </div>
      <div class="status-info" *ngIf="macDispositivo">
        <div class="divider-line"></div>
        <p><strong>Impresora Registrada:</strong> {{ nombreDispositivo }}</p>
        <p><strong>Dirección MAC:</strong> {{ macDispositivo }}</p>
        <p><strong>Asignada a Caja:</strong> {{ EditCaja.codigo }}</p>
      </div>

      <div class="empty-state-list" *ngIf="!dispositivoSeleccionado && !macDispositivo">
        <ion-icon name="help-circle-outline"></ion-icon>
        <p>Sin impresora conectada o registrada.</p>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-card class="main-card fade-in-up">
    <ion-card-header class="card-header-icon">
      <ion-icon name="build-outline"></ion-icon>
      <ion-card-title>Acciones</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-button
        expand="block"
        color="success"
        [disabled]="!dispositivoSeleccionado"
        (click)="imprimirTicket()"
        class="action-button-success"
      >
        <ion-icon name="print-outline"></ion-icon>
        Testeo de Impresión
      </ion-button>
      <ion-button
        expand="block"
        color="primary"
        [disabled]="!dispositivoSeleccionado"
        (click)="updateImpresora()"
        class="action-button-primary"
      >
        <ion-icon name="save-outline"></ion-icon>
        Guardar Impresora
      </ion-button>
    </ion-card-content>
  </ion-card>

  </ion-content>

<ion-footer class="ion-no-border footer-total">
  <ion-toolbar>
    <ion-title class="ion-text-center">© 2025 Configurar Impresora</ion-title>
  </ion-toolbar>
</ion-footer>