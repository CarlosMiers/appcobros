<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="volver()">
        <ion-icon name="arrow-back-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="ion-text-center">{{ pageTitle }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Cliente y Moneda -->
  <ion-card>
    <ion-card-header>
      <ion-card-title class="ion-text-center">🧾 Datos del Recibo</ion-card-title>
    </ion-card-header>
    <ion-card-content>

      <!-- Número de Recibo -->
      <ion-item>
        <ion-label position="stacked">N° Recibo</ion-label>
        <ion-input [(ngModel)]="cobranza.numero" [readonly]="idcobro > 0"></ion-input>
      </ion-item>

      <!-- Fecha -->
      <ion-item>
        <ion-label position="stacked">Fecha</ion-label>
        <ion-input type="date" [(ngModel)]="cobranza.fecha"></ion-input>
      </ion-item>

      <!-- Cliente por Código -->
      <ion-item>
        <ion-label position="stacked">Código de Cliente</ion-label>
        <ion-input [(ngModel)]="cobranza.cliente"></ion-input>
      </ion-item>

      <ion-button expand="block" color="tertiary" (click)="validarCliente()">🔍 Consultar Cliente</ion-button>

      <!-- Nombre del Cliente -->
      <div class="ion-text-center ion-padding-top">
        <h2 style="font-size: 1rem; font-weight: 500;">{{ cobranza.clienteNombre || 'Cliente no encontrado' }}</h2>
      </div>

      <!-- Observación -->
      <ion-item>
        <ion-label position="stacked">Observación</ion-label>
        <ion-textarea [(ngModel)]="cobranza.observacion" rows="3"></ion-textarea>
      </ion-item>

    </ion-card-content>

  </ion-card> <!-- Cuentas a Cobrar -->
  <ion-card>
    <ion-card-header>
      <ion-card-title class="ion-text-center">📄 Cuentas Pendientes</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="ion-text-center" *ngIf="cuentasPendientes.length === 0">
        <h4 style="color: #666;">No hay cuentas pendientes para este cliente.</h4>
      </div>

      <ion-grid *ngIf="cuentasPendientes.length > 0">
        <ion-row>
          <ion-col size="12" sizeMd="6" *ngFor="let cuenta of cuentasPendientes">
            <ion-card class="cuenta-card">
              <ion-item lines="none">
                <ion-checkbox slot="start" [(ngModel)]="cuenta.seleccionado"
                  (ionChange)="recalcularTotal()"></ion-checkbox>
                <ion-label>
                  <h2>{{ cuenta.documento }}</h2>
                  <p>Emisión: {{ cuenta.fecha | date:'shortDate' }}</p>
                  <p>Vence: {{ cuenta.vencimiento | date:'shortDate' }}</p>
                  <p>Saldo: {{ cuenta.saldo | number:'1.2-2' }} {{ getMonedaTexto(cuenta.moneda) }}</p>
                </ion-label>
              </ion-item>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
</ion-content>

<ion-card>
  <ion-card-header>
    <ion-card-title class="ion-text-center">💰Resumen del Cobro</ion-card-title>
  </ion-card-header>
  <ion-card-content>

    <ion-item lines="none">
      <ion-label>
        <h3>Total a Cobrar:</h3>
      </ion-label>
      <ion-text color="primary">
        <h3 style="font-weight: bold;">{{ totalSeleccionado | number:'1.2-2' }}</h3>
      </ion-text>
    </ion-item>
  </ion-card-content>
</ion-card>

<!-- Botón Guardar -->
<ion-footer class="ion-padding">
  <ion-grid>
    <ion-row>
      <ion-col>
        <ion-button expand="block" color="success" (click)="guardarCobro()">
          💾 Grabar
        </ion-button>
      </ion-col>
      <ion-col>
        <ion-button expand="block" color="medium" (click)="volver()">
          ↩️ Salir
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-footer>