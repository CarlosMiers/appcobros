<ion-header class="ion-no-border">
  <ion-toolbar class="header-gradient">
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="dismiss()" class="back-button">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title class="header-title">
      <div class="title-container">
        <ion-icon name="cube" class="title-icon"></ion-icon>
        Lista de Productos
      </div>
    </ion-title>

  </ion-toolbar>

  <ion-toolbar class="search-toolbar">
    <div class="search-container">
      <ion-searchbar
        class="modern-searchbar"
        placeholder="Buscar por nombre"
        (ionInput)="buscar($event)"
        [value]="textoBuscar"
        animated
        show-clear-button="focus"
        search-icon="search"
        clear-icon="close-circle">
      </ion-searchbar>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="content-background">
  <div *ngIf="isLoading" class="loading-container">
    <div *ngFor="let item of [1,2,3]" class="skeleton-card">
      <div class="skeleton-avatar"></div>
      <div class="skeleton-content">
        <div class="skeleton-line skeleton-title"></div>
        <div class="skeleton-line skeleton-subtitle"></div>
        <div class="skeleton-info">
          <div class="skeleton-line skeleton-small"></div>
          <div class="skeleton-line skeleton-small"></div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading" class="products-container">
    <div *ngIf="(productos | filtro:textoBuscar:'nombre').length === 0" class="empty-state">
      <div class="empty-icon">
        <ion-icon name="cube-outline"></ion-icon>
      </div>
      <h3>No se encontraron productos</h3>
      <p>{{ textoBuscar ? 'Intenta ajustar tu búsqueda' : 'Comienza agregando tu primer producto' }}</p>
    </div>

    <ion-list class="products-list" lines="none" *ngIf="(productos | filtro:textoBuscar:'nombre').length > 0">
      <ion-item-sliding 
        *ngFor="let datos of productos | filtro:textoBuscar:'nombre'; let i = index" 
        #slidingItem>
        
        <ion-card 
          class="product-card fade-in-up" 
          [style.animation-delay]="(i * 0.1) + 's'"
          button 
          (click)="openEditProductoModal(datos.codigo)">
          
          <div class="product-avatar-container">
            <div class="product-avatar">
              <ion-icon name="cube-outline"></ion-icon>
            </div>
            <ion-badge class="status-badge" color="primary">Disponible</ion-badge>
          </div>

          <ion-card-header class="product-card-header">
            <ion-card-title class="product-name ion-text-capitalize">{{ datos.nombre }}</ion-card-title>
          </ion-card-header>

          <ion-card-content class="product-card-content">
            <ion-grid class="info-grid">
              <ion-row>
                <ion-col size="6">
                  <div class="info-item">
                    <div class="info-icon-container">
                      <ion-icon name="barcode" class="info-icon"></ion-icon>
                    </div>
                    <div class="info-content">
                      <span class="info-label">Código GS</span>
                      <span class="info-value">{{ datos.codigo }}</span>
                    </div>
                  </div>
                </ion-col>
                
                <ion-col size="6">
                  <div class="info-item">
                    <div class="info-icon-container">
                      <ion-icon name="pricetag" class="info-icon"></ion-icon>
                    </div>
                    <div class="info-content">
                      <span class="info-label">Precio</span>
                      <span class="info-value">{{ datos.precio_maximo | currency:'GS':'symbol':'1.0-0' }}</span>
                    </div>
                  </div>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-card-content>

          <div class="action-indicator">
            <ion-icon name="chevron-forward"></ion-icon>
          </div>
        </ion-card>

        <ion-item-options side="end">
          <ion-item-option 
            color="primary" 
            (click)="openEditProductoModal(datos.codigo); slidingItem.close()">
            <ion-icon name="create" slot="icon-only"></ion-icon>
          </ion-item-option>
          
          <ion-item-option 
            color="tertiary" 
            (click)="presentActionSheet(datos.codigo); slidingItem.close()">
            <ion-icon name="ellipsis-horizontal" slot="icon-only"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>
  </div>

  <ion-fab 
    vertical="bottom" 
    horizontal="end" 
    slot="fixed" 
    class="fab-container"
    edge>
    <ion-fab-button 
      class="main-fab" 
      color="success"
      (click)="openEditProductoModal('')">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>

<ion-footer class="ion-no-border">
  <ion-toolbar class="footer-toolbar">
    <div class="pagination-container">
      <div class="page-info">
        <ion-text color="medium">
          Página {{ page }} • {{ (productos | filtro:textoBuscar:'nombre').length }} resultados
        </ion-text>
      </div>
      
      <div class="nav-buttons">
        <ion-button
          class="nav-button"
          fill="outline"
          size="small"
          color="primary"
          (click)="prevPage()"
          [disabled]="page === 1">
          <ion-icon name="chevron-back" slot="start"></ion-icon>
          Anterior
        </ion-button>
        
        <ion-button
          class="nav-button"
          fill="outline"
          size="small"
          color="primary"
          (click)="nextPage()">
          Siguiente
          <ion-icon name="chevron-forward" slot="end"></ion-icon>
        </ion-button>
      </div>
    </div>
  </ion-toolbar>
</ion-footer>